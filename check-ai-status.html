<!DOCTYPE html>
<html>
<head>
    <title>AI Status Checker</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 10px 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        button:hover {
            background: #00cc00;
        }
        #output {
            margin-top: 20px;
            white-space: pre-wrap;
            border: 1px solid #00ff00;
            padding: 15px;
            background: #000;
        }
        .ready { color: #00ff00; }
        .waiting { color: #ffaa00; }
        .error { color: #ff0000; }
    </style>
</head>
<body>
    <h1>üß† AI Recommendations Status Checker</h1>
    <p>Make sure you're logged in to https://forex-market-anz.pages.dev first!</p>

    <button onclick="checkStatus()">1. Check Symbol Status</button>
    <button onclick="runBacktest()">2. Run Backtesting</button>
    <button onclick="checkRecommendations()">3. Check Recommendations</button>

    <div id="output"></div>

    <script>
        const API_BASE = 'https://forex-market-anz.onrender.com';

        function log(msg, className = '') {
            const output = document.getElementById('output');
            const line = document.createElement('div');
            if (className) line.className = className;
            line.textContent = msg;
            output.appendChild(line);
        }

        function clearOutput() {
            document.getElementById('output').innerHTML = '';
        }

        async function checkStatus() {
            clearOutput();
            log('üîç Checking symbol data...\n');

            try {
                const response = await fetch(API_BASE + '/api/ai/insights', {
                    credentials: 'include',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem('token')
                    }
                });

                if (!response.ok) {
                    log('‚ùå Error: ' + response.status + ' ' + response.statusText, 'error');
                    log('Make sure you are logged in as admin!', 'error');
                    return;
                }

                const data = await response.json();

                log('=== AI INSIGHTS ===');
                log('Total Signals: ' + data.totalSignals);
                log('Completed Signals: ' + data.completedSignals);
                log('Win Rate: ' + data.winRate + '%');
                log('');

                const ready = data.symbolInsights.filter(s => s.hasEnoughData);
                const notReady = data.symbolInsights.filter(s => !s.hasEnoughData);

                if (ready.length > 0) {
                    log('‚úÖ READY FOR BACKTESTING:', 'ready');
                    ready.forEach(s => {
                        log('  ' + s.symbol + ': ' + s.totalSignals + ' signals (' + s.winRate.toFixed(1) + '% win rate)', 'ready');
                    });
                } else {
                    log('‚ùå NO SYMBOLS READY YET', 'error');
                }

                if (notReady.length > 0) {
                    log('');
                    log('‚è≥ STILL COLLECTING DATA:', 'waiting');
                    notReady.forEach(s => {
                        log('  ' + s.symbol + ': ' + s.totalSignals + '/30 signals (' + Math.round(s.totalSignals/30*100) + '%)', 'waiting');
                    });
                }

                log('');
                if (ready.length > 0) {
                    log('üöÄ Ready to run backtesting! Click button 2.', 'ready');
                } else {
                    log('‚è≥ Not ready yet. Need at least 1 symbol with 30+ signals.', 'waiting');
                }

            } catch (err) {
                log('‚ùå Error: ' + err.message, 'error');
            }
        }

        async function runBacktest() {
            clearOutput();
            log('üî¨ Triggering backtesting...\n');

            try {
                const response = await fetch(API_BASE + '/api/ai/backtest', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem('token')
                    }
                });

                if (!response.ok) {
                    log('‚ùå Error: ' + response.status + ' ' + response.statusText, 'error');
                    return;
                }

                const data = await response.json();
                log('‚úÖ Response: ' + JSON.stringify(data, null, 2), 'ready');
                log('');
                log('‚è≥ Wait 60 seconds, then click button 3 to check recommendations.', 'waiting');

            } catch (err) {
                log('‚ùå Error: ' + err.message, 'error');
            }
        }

        async function checkRecommendations() {
            clearOutput();
            log('üìã Checking recommendations...\n');

            try {
                const response = await fetch(API_BASE + '/api/ai/recommendations', {
                    credentials: 'include',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem('token')
                    }
                });

                if (!response.ok) {
                    log('‚ùå Error: ' + response.status + ' ' + response.statusText, 'error');
                    return;
                }

                const data = await response.json();

                if (data.length === 0) {
                    log('‚ÑπÔ∏è  No recommendations found.', 'waiting');
                    log('');
                    log('This means either:');
                    log('1. Backtesting has not been run yet (click button 2)');
                    log('2. Backtesting found no improvements > 5%');
                    log('3. No symbols have 30+ signals yet (click button 1)');
                } else {
                    log('‚úÖ Found ' + data.length + ' recommendation(s):', 'ready');
                    log('');
                    data.forEach((rec, i) => {
                        log('--- Recommendation ' + (i+1) + ' ---');
                        log('Symbol: ' + rec.symbol);
                        log('Title: ' + rec.recommendation_title);
                        log('Expected Improvement: +' + rec.expected_win_rate_improvement + '% win rate');
                        log('Based on: ' + rec.based_on_signals + ' signals');
                        log('Status: ' + rec.status);
                        log('');
                    });
                    log('‚úÖ Go to Admin ‚Üí AI Insights tab to approve/reject!', 'ready');
                }

            } catch (err) {
                log('‚ùå Error: ' + err.message, 'error');
            }
        }
    </script>
</body>
</html>
